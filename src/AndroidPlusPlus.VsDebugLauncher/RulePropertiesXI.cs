////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

using System;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.Diagnostics.CodeAnalysis;
using System.Threading.Tasks;

using Microsoft.VisualStudio.Project;
using Microsoft.VisualStudio.Project.Utilities;
using Microsoft.VisualStudio.Project.Properties;

using AndroidPlusPlus.Common;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace AndroidPlusPlus.VsDebugLauncher.Rules
{

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  [Export]

  [PartMetadata(ProjectCapabilities.Requires, ProjectCapabilities.VisualC)]

  internal partial class RuleProperties
  {

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    [Import]
    [SuppressMessage ("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "Required, but should always be null.")]
    private ConfiguredProject ConfiguredProject { get; set; }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    [SuppressMessage ("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "Required, but should always be null.")]
    private string File { get; set; }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    [SuppressMessage ("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "Required, but should always be null.")]
    private string ItemType { get; set; }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    [SuppressMessage ("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode", Justification = "Required, but should always be null.")]
    private string ItemName { get; set; }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public ConfiguredProject GetConfiguredProject ()
    {
      return ConfiguredProject;
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    public Dictionary <string, string> ProjectPropertiesToDictionary ()
    {
      Dictionary<string, string> evaluatedProperties = new Dictionary<string, string> ();

      IPropertyPagesCatalog projectPropertyList = ConfiguredProject.Services.PropertyPagesCatalog.GetCatalog ("Project");

      IEnumerable <string> projectPropertySchemas = projectPropertyList.GetPropertyPagesSchemas ();

      foreach (string schema in projectPropertySchemas)
      {
        IRule schemaRules = projectPropertyList.BindToContext (schema, File, ItemType, ItemName);

        foreach (IProperty properties in schemaRules.Properties)
        {
          try
          {
            IEvaluatedProperty evaluatedProperty = (IEvaluatedProperty)properties;

            string schemaGroupedKey = schema + "." + properties.Name;

            evaluatedProperties [schemaGroupedKey] = evaluatedProperty.EvaluatedValueAtEnd;
          }
          catch (Exception e)
          {
            LoggingUtils.HandleException (e);
          }
        }
      }

      return evaluatedProperties;
    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

  }

  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
